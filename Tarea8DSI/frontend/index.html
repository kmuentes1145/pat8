<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gesti贸n de Inventario</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<script>
const API_URL = "https://pat8-production.up.railway.app";
let editandoId = null;
</script>

<!-- LOGIN -->
<div id="loginScreen" class="container mt-5 text-center">
  <div class="card mx-auto" style="max-width:400px">
    <div class="card-body">
      <h3> Login</h3>
      <form id="loginForm">
        <input type="email" id="email" class="form-control mb-2" placeholder="Email" required>
        <input type="password" id="password" class="form-control mb-2" placeholder="Password" required>
        <button class="btn btn-success w-100">Ingresar</button>
        <button type="button" class="btn btn-link" onclick="mostrarRegistro()">Registrarse</button>
      </form>
    </div>
  </div>
</div>

<!-- REGISTRO -->
<div id="registerScreen" class="container mt-5 text-center" style="display:none">
  <div class="card mx-auto" style="max-width:400px">
    <div class="card-body">
      <h3> Registro</h3>
      <form id="registerForm">
        <input type="text" id="regNombre" class="form-control mb-2" placeholder="Nombre" required>
        <input type="email" id="regEmail" class="form-control mb-2" placeholder="Email" required>
        <input type="password" id="regPassword" class="form-control mb-2" placeholder="Password" required>
        <button class="btn btn-primary w-100">Registrar</button>
        <button type="button" class="btn btn-link" onclick="mostrarLogin()">Volver</button>
      </form>
    </div>
  </div>
</div>

<!-- INVENTARIO -->
<div id="inventarioScreen" style="display:none">
<div class="container mt-4">

<h4> Inventario</h4>
<button class="btn btn-danger btn-sm mb-3" onclick="cerrarSesion()">Cerrar sesi贸n</button>

<form id="formProducto" class="card p-3 mb-3">
<input type="hidden" id="id">
<input class="form-control mb-2" id="nombre" placeholder="Nombre" required>
<input class="form-control mb-2" id="codigo" placeholder="C贸digo" required>
<input class="form-control mb-2" id="categoria" placeholder="Categor铆a">
<input class="form-control mb-2" id="precio" type="number" placeholder="Precio" required>
<input class="form-control mb-2" id="stock" type="number" placeholder="Stock" required>
<input class="form-control mb-2" id="descripcion" placeholder="Descripci贸n">
<button class="btn btn-primary">Guardar</button>
</form>

<table class="table table-striped">
<thead>
<tr>
<th>Nombre</th>
<th>C贸digo</th>
<th>Stock</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="listaProductos"></tbody>
</table>

</div>
</div>

<script>
const loginScreen = document.getElementById("loginScreen");
const registerScreen = document.getElementById("registerScreen");
const inventarioScreen = document.getElementById("inventarioScreen");
const lista = document.getElementById("listaProductos");

function mostrarRegistro(){
loginScreen.style.display="none";
registerScreen.style.display="block";
}
function mostrarLogin(){
registerScreen.style.display="none";
loginScreen.style.display="block";
}

document.getElementById("registerForm").onsubmit = async e =>{
e.preventDefault();
await fetch(`${API_URL}/auth/register`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
nombre:regNombre.value,
email:regEmail.value,
password:regPassword.value
})
});
alert("Usuario registrado");
mostrarLogin();
};

document.getElementById("loginForm").onsubmit = async e =>{
e.preventDefault();
const res = await fetch(`${API_URL}/auth/login`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({email:email.value,password:password.value})
});
const data = await res.json();
if(res.ok){
loginScreen.style.display="none";
inventarioScreen.style.display="block";
cargarProductos();
}else alert(data.msg);
};

function cerrarSesion(){
location.reload();
}

async function cargarProductos(){
const res = await fetch(`${API_URL}/productos`);
const data = await res.json();
lista.innerHTML="";
data.forEach(p=>{
lista.innerHTML+=`
<tr>
<td>${p.nombre}</td>
<td>${p.codigo}</td>
<td>${p.stock}</td>
<td>
<button class="btn btn-warning btn-sm me-1" onclick="editarProducto(${p.id})">Editar</button>
<button class="btn btn-danger btn-sm" onclick="eliminar(${p.id})">Eliminar</button>
</td>
</tr>`;
});
}

async function editarProducto(id){
const res = await fetch(`${API_URL}/productos`);
const productos = await res.json();
const p = productos.find(x => x.id === id);

nombre.value = p.nombre;
codigo.value = p.codigo;
categoria.value = p.categoria;
precio.value = p.precio;
stock.value = p.stock;
descripcion.value = p.descripcion;

editandoId = id;
}

document.getElementById("formProducto").onsubmit = async e =>{
e.preventDefault();

const data = {
nombre:nombre.value,
codigo:codigo.value,
categoria:categoria.value,
precio:precio.value,
stock:stock.value,
descripcion:descripcion.value
};

if(editandoId){
await fetch(`${API_URL}/productos/${editandoId}`,{
method:"PUT",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(data)
});
editandoId=null;
}else{
await fetch(`${API_URL}/productos`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(data)
});
}

e.target.reset();
cargarProductos();
};

async function eliminar(id){
await fetch(`${API_URL}/productos/${id}`,{method:"DELETE"});
cargarProductos();
}
</script>

</body>
</html>

